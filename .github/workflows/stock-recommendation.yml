name: 每日股票推荐自动化
on:
  schedule:
    # 定时触发：21:00 执行数据更新，22:00 执行推荐生成（时区为 UTC，需转换为 UTC+8，即 UTC 13:00=21:00，UTC 14:00=22:00）
    - cron: '0 13 * * *'  # 21:00（UTC+8）执行数据更新
    - cron: '0 14 * * *'  # 22:00（UTC+8）执行推荐生成
  workflow_dispatch:  # 手动触发（方便测试）

jobs:
  run-stock-recommendation:
    runs-on: ubuntu-latest  # 使用 Ubuntu 服务器
    steps:
      # 步骤1：拉取代码到服务器
      - name: 拉取仓库代码
        uses: actions/checkout@v4

      # 步骤2：配置 Python 环境
      - name: 设置 Python 3.8
        uses: actions/setup-python@v5
        with:
          python-version: '3.8'

      # 步骤3：安装依赖库
      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy baostock

      # 步骤4：执行数据更新（21:00 触发时执行）
      - name: 执行A股数据更新
        if: github.event.schedule == '0 13 * * *'
        run: |
          cd skills/A_stock_data_download
          python data_download.py  # 替换为你的数据更新脚本名

      # 步骤5：执行技术指标分析（stock_macd_volumn）
      - name: 执行MACD&成交量分析
        if: github.event.schedule == '0 14 * * *'
        run: |
          cd skills/stock_macd_volumn
          python daily_analysis.py  # 替换为你的分析脚本名

      # 步骤6：生成股票推荐报告
      - name: 生成每日推荐报告
        if: github.event.schedule == '0 14 * * *'
        run: |
          cd skills/stock_daily_recommendation
          python daily_recommendation.py

      # 步骤7：上传报告到 GitHub 仓库（持久化存储）
      - name: 上传推荐报告
        if: github.event.schedule == '0 14 * * *'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '自动更新：2026-{{ github.run_id }} 股票推荐报告'
          file_pattern: 'skills/stock_daily_recommendation/recommendations/*'
