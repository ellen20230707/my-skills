# 邮件发送功能配置指南

## 📧 功能说明

每天22:00（北京时间）自动生成推荐报告后，系统会将TXT格式报告作为附件发送到您的邮箱：**22894196@qq.com**

---

## 🔧 配置步骤

### 第一步：开启QQ邮箱SMTP服务

1. **登录QQ邮箱**
   - 访问：https://mail.qq.com
   - 使用您的QQ账号登录（22894196）

2. **进入设置页面**
   - 点击顶部的 **"设置"**
   - 选择 **"账户"** 标签页

3. **开启SMTP服务**
   - 找到 **"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"** 部分
   - 找到 **"IMAP/SMTP服务"** 或 **"POP3/SMTP服务"**
   - 点击 **"开启"** 按钮

4. **获取授权码**
   - 开启服务时，系统会要求验证（发送短信到绑定的手机）
   - 验证成功后，QQ邮箱会显示一个 **授权码**（16位字符）
   - **重要：请妥善保存这个授权码！** 这不是您的QQ密码，而是专门用于第三方客户端登录的密码

   示例授权码格式：`abcdefghijklmnop`（实际是16位随机字符）

5. **如果之前已开启但忘记授权码**
   - 点击 **"生成授权码"** 重新生成
   - 每次生成的授权码都不同，新授权码会使旧授权码失效

---

### 第二步：在GitHub仓库中添加Secrets

GitHub Secrets用于安全地存储敏感信息（如密码），避免直接暴露在代码中。

1. **进入仓库设置**
   - 打开您的GitHub仓库：https://github.com/ellen20230707/my-skills
   - 点击顶部的 **"Settings"** 标签页

2. **添加Secrets**
   - 在左侧菜单中找到 **"Secrets and variables"**
   - 点击展开，选择 **"Actions"**
   - 点击右上角的 **"New repository secret"** 按钮

3. **添加第一个Secret：MAIL_USERNAME**
   - **Name**: `MAIL_USERNAME`
   - **Secret**: `22894196@qq.com`
   - 点击 **"Add secret"**

4. **添加第二个Secret：MAIL_PASSWORD**
   - 再次点击 **"New repository secret"**
   - **Name**: `MAIL_PASSWORD`
   - **Secret**: 粘贴您在第一步获取的QQ邮箱授权码（16位字符）
   - 点击 **"Add secret"**

5. **验证Secrets已添加**
   - 返回 **"Actions secrets"** 页面
   - 您应该看到两个Secrets：
     - `MAIL_USERNAME`
     - `MAIL_PASSWORD`
   - ⚠️ 注意：添加后无法查看Secret的值，只能重新编辑

---

### 第三步：测试邮件发送

1. **手动触发工作流**
   - 进入仓库的 **"Actions"** 标签页
   - 选择 **"每日股票推荐生成"** 工作流
   - 点击 **"Run workflow"** → 选择 `main` 分支 → 点击绿色的 **"Run workflow"** 按钮

2. **查看执行结果**
   - 等待工作流执行完成（约2-5分钟）
   - 检查 **"发送邮件通知"** 步骤是否成功
   - 成功标志：显示绿色对勾 ✅

3. **检查邮箱**
   - 登录 22894196@qq.com
   - 查找来自 **"22894196@qq.com"** 的邮件
   - 邮件主题：**📊 每日股票推荐报告 - YYYY-MM-DD**
   - 附件：`recommendation_YYYYMMDD.txt`

---

## 📋 邮件格式示例

**主题：** 📊 每日股票推荐报告 - 2026-02-10

**正文：**
```
您好！

附件是今日的A股推荐报告（2026-02-10）。

报告包含基于MACD、成交量、均线等技术指标筛选出的潜力股票。

详细信息请查看附件。

---
🤖 由GitHub Actions自动生成
📅 生成时间：2026-02-10 22:05:32 CST
```

**附件：** recommendation_20260210.txt

---

## 🔍 故障排查

### 问题1：邮件发送失败 - 认证错误

**错误信息：**
```
535 Login Fail. Please enter your authorization code to login.
```

**原因：** 授权码错误或未开启SMTP服务

**解决方案：**
1. 重新登录QQ邮箱，确认SMTP服务已开启
2. 重新生成授权码
3. 在GitHub Secrets中更新 `MAIL_PASSWORD`

---

### 问题2：邮件发送失败 - 连接超时

**错误信息：**
```
Connection timeout
```

**原因：** GitHub Actions服务器可能无法访问smtp.qq.com

**解决方案：**
- 这种情况较少见，通常重试即可
- 如果持续失败，可以考虑使用其他邮箱服务（如Gmail、163邮箱）

---

### 问题3：收不到邮件

**检查步骤：**
1. 确认QQ邮箱的垃圾邮件文件夹
2. 检查工作流日志中的"发送邮件通知"步骤是否成功
3. 确认 `MAIL_USERNAME` 是否设置为 `22894196@qq.com`
4. 确认推荐报告是否成功生成（检查前面的步骤）

---

### 问题4：附件丢失

**原因：** 推荐报告未生成或文件路径错误

**检查：**
1. 查看工作流日志中的"生成推荐报告"步骤
2. 确认 `skills/stock_daily_recommendation/recommendations/` 目录中有当天的TXT文件

---

## 🔐 安全说明

1. **授权码保护**
   - 授权码等同于密码，请勿泄露
   - 不要直接写在代码中
   - 只通过GitHub Secrets存储

2. **GitHub Secrets安全性**
   - Secrets加密存储在GitHub服务器
   - 工作流日志中会自动隐藏Secret值（显示为 `***`）
   - 只有仓库管理员可以编辑Secrets

3. **撤销授权码**
   - 如果怀疑授权码泄露，立即在QQ邮箱中重新生成
   - 更新GitHub Secrets中的 `MAIL_PASSWORD`

---

## 📅 自动执行时间

- **定时任务**：每天 **22:00** 北京时间（CST）
- **执行流程**：
  1. 21:00 - 数据更新
  2. 22:00 - 生成推荐报告
  3. 22:05 - 发送邮件（约5分钟后）

- **手动触发**：随时可在GitHub Actions页面手动运行

---

## 🛠️ 技术参数

| 配置项 | 值 |
|--------|-----|
| **SMTP服务器** | smtp.qq.com |
| **端口** | 465 (SSL) |
| **发件人** | 22894196@qq.com |
| **收件人** | 22894196@qq.com |
| **认证方式** | 授权码 |
| **附件格式** | TXT文本文件 |

---

## ✅ 配置完成检查清单

- [ ] QQ邮箱SMTP服务已开启
- [ ] 已获取16位授权码
- [ ] GitHub Secrets中已添加 `MAIL_USERNAME`
- [ ] GitHub Secrets中已添加 `MAIL_PASSWORD`
- [ ] 已手动触发工作流测试
- [ ] 邮件发送步骤显示成功 ✅
- [ ] 已在邮箱中收到测试邮件

---

## 📞 常见QQ邮箱问题

### 如何找回授权码？
授权码无法找回，只能重新生成。进入QQ邮箱设置 → 账户 → SMTP服务 → 生成授权码。

### 一个邮箱可以生成多个授权码吗？
可以。每个第三方应用可以使用不同的授权码，方便管理。

### 授权码会过期吗？
正常情况下不会过期，除非您手动重新生成或关闭SMTP服务。

---

**配置完成后，系统将每天自动发送推荐报告到您的邮箱！** 📬

**版本**: v1.0
**更新日期**: 2026-02-10
**维护者**: Claude & Ellen Li
